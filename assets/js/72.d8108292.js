(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{488:function(e,a,t){"use strict";t.r(a);var l=t(0),o=Object(l.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"live-upgrade-tutorial"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#live-upgrade-tutorial"}},[e._v("#")]),e._v(" Live Upgrade Tutorial")]),e._v(" "),t("p",[e._v("This document demonstrates how a live upgrade can be performed on-chain through a\ngovernance process.")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Start the network and trigger upgrade")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"IyBzdGFydCBhIGdhaWEgYXBwbGljYXRpb24gZnVsbC1ub2RlCiQgbWluZXBsZXgtY2hhaW5kIHN0YXJ0CgojIHNldCB1cCB0aGUgY2xpIGNvbmZpZwokIG1pbmVwbGV4LWNoYWluZCBjb25maWcgdHJ1c3Qtbm9kZSB0cnVlCiQgbWluZXBsZXgtY2hhaW5kIGNvbmZpZyBjaGFpbi1pZCB0ZXN0aW5nCgojIGNyZWF0ZSBhbiB1cGdyYWRlIGdvdmVybmFuY2UgcHJvcG9zYWwKJCBtaW5lcGxleC1jaGFpbmQgdHggZ292IHN1Ym1pdC1wcm9wb3NhbCBzb2Z0d2FyZS11cGdyYWRlICZsdDtwbGFuLW5hbWUmZ3Q7IFwKLS10aXRsZSAmbHQ7cHJvcG9zYWwtdGl0bGUmZ3Q7IC0tZGVzY3JpcHRpb24gJmx0O3Byb3Bvc2FsLWRlc2NyaXB0aW9uJmd0OyBcCi0tZnJvbSAmbHQ7bmFtZS1vci1rZXkmZ3Q7IC0tdXBncmFkZS1oZWlnaHQgJmx0O2Rlc2lyZWQtdXBncmFkZS1oZWlnaHQmZ3Q7IC0tZGVwb3NpdCAxMDAwMDAwMG1weAoKIyBvbmNlIHRoZSBwcm9wb3NhbCBwYXNzZXMgeW91IGNhbiBxdWVyeSB0aGUgcGVuZGluZyBwbGFuCiQgbWluZXBsZXgtY2hhaW5kIHF1ZXJ5IHVwZ3JhZGUgcGxhbgo="}})],1),e._v(" "),t("li",[t("p",[e._v("Performing an upgrade")]),e._v(" "),t("p",[e._v("Assuming the proposal passes the chain will stop at given upgrade height.")]),e._v(" "),t("p",[e._v("You can stop and start the original binary all you want, but "),t("strong",[e._v("it will refuse to\nrun after the upgrade height")]),e._v(".")]),e._v(" "),t("p",[e._v("We need a new binary with the upgrade handler installed. The logs should look\nsomething like:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"RVsyMDE5LTExLTA1fDEyOjQ0OjE4LjkxM10gVVBHUkFERSAmcXVvdDsmbHQ7cGxhbi1uYW1lJmd0OyZxdW90OyBORUVERUQgYXQgaGVpZ2h0OiAmbHQ7ZGVzaXJlZC11cGdyYWRlLWhlaWdodCZndDs6ICAgICAgIG1vZHVsZT1tYWluCkVbMjAxOS0xMS0wNXwxMjo0NDoxOC45MTRdIENPTlNFTlNVUyBGQUlMVVJFISEhCi4uLgo="}}),e._v(" "),t("p",[e._v("Note that the process will hang indefinitely (doesn't exit to avoid restart loops). So, you must\nmanually kill the process and replace it with a new binary. Do so now with "),t("code",[e._v("Ctrl+C")]),e._v(" or "),t("code",[e._v("killall mineplex-chaind")]),e._v(".")]),e._v(" "),t("p",[e._v("In "),t("code",[e._v("gaia/app/app.go")]),e._v(", after "),t("code",[e._v("upgrade.Keeper")]),e._v(" is initialized and set in the app, set the\ncorresponding upgrade "),t("code",[e._v("Handler")]),e._v(" with the correct "),t("code",[e._v("<plan-name>")]),e._v(":")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"go",base64:"ICAgIGFwcC51cGdyYWRlS2VlcGVyLlNldFVwZ3JhZGVIYW5kbGVyKCZxdW90OyZsdDtwbGFuLW5hbWUmZ3Q7JnF1b3Q7LCBmdW5jKGN0eCBzZGsuQ29udGV4dCwgcGxhbiB1cGdyYWRlLlBsYW4pIHsKICAgICAgICAvLyBjdXN0b20gbG9naWMgYWZ0ZXIgdGhlIG5ldHdvcmsgdXBncmFkZSBoYXMgYmVlbiBleGVjdXRlZAogICAgfSkK"}}),e._v(" "),t("p",[e._v("Note that we panic on any error - this would cause the upgrade to fail if the\nmigration could not be run, and no node would advance - allowing a manual recovery.\nIf we ignored the errors, then we would proceed with an incomplete upgrade and\nhave a very difficult time every recovering the proper state.")]),e._v(" "),t("p",[e._v("Now, compile the new binary and run the upgraded code to complete the upgrade:")]),e._v(" "),t("tm-code-block",{staticClass:"codeblock",attrs:{language:"bash",base64:"IyBjcmVhdGUgYSBuZXcgYmluYXJ5IG9mIGdhaWEgd2l0aCB0aGUgYWRkZWQgdXBncmFkZSBoYW5kbGVyCiQgbWFrZSBpbnN0YWxsCgojIFJlc3RhcnQgdGhlIGNoYWluIHVzaW5nIHRoZSBuZXcgYmluYXJ5LiBZb3Ugc2hvdWxkIHNlZSB0aGUgY2hhaW4gcmVzdW1lIGZyb20KIyB0aGUgdXBncmFkZSBoZWlnaHQ6CiMgYElbMjAxOS0xMS0wNXwxMjo0ODoxNS4xODRdIGFwcGx5aW5nIHVwZ3JhZGUgJmx0O3BsYW4tbmFtZSZndDsgYXQgaGVpZ2h0OiAmbHQ7ZGVzaXJlZC11cGdyYWRlLWhlaWdodCZndDsgICAgICBtb2R1bGU9bWFpbmAKJCBtaW5lcGxleC1jaGFpbmQgc3RhcnQKCiMgdmVyaWZ5IHRoZXJlIGlzIG5vIHBlbmRpbmcgcGxhbgokIG1pbmVwbGV4LWNoYWluZCBxdWVyeSB1cGdyYWRlIHBsYW4KCiMgdmVyaWZ5IHlvdSBjYW4gcXVlcnkgdGhlIGJsb2NrIGhlYWRlciBvZiB0aGUgY29tcGxldGVkIHVwZ3JhZGUKJCBtaW5lcGxleC1jaGFpbmQgcXVlcnkgdXBncmFkZSBhcHBsaWVkICZsdDtwbGFuLW5hbWUmZ3Q7Cg=="}})],1)])])}),[],!1,null,null,null);a.default=o.exports}}]);